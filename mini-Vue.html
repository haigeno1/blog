<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
</head>
<body>
  <div id="app"></div>
</body>
</html>
<script>
  var updateSchedulaed = false

  var data = {
    a: 1,
    b: 2,
    c: 3
  }

  var el = document.querySelector('#app')

  function render(data) {
    return `<div>${data.a}, ${data.b}, ${data.c}</div>`
  }

  function update() {
    var dom = render(data)
    el.innerHTML = dom
    updateSchedulaed = false
  }

  function observer(obj) {
    function isObject(val) {
      return Object.prototype.toString.call(val) === '[object Object]'
    }



    var copy = {}

    for(let key in obj) {
      if (isObject(obj[key])) {
        copy[key] = observer(obj[key])
      } else {
        copy[key] = obj[key]
      }

      Object.defineProperty(obj, key, {
        get: function(){
          return copy[key]
        },
        set: function(val){
          if (!updateSchedulaed) {
            Promise.resolve().then(update)
          }
          if (isObject(val)) {
            val = observer(val)
          }
          copy[key] = val
        }
      })
    }
    return obj
  }


  observer(data)
  update()
  
</script>